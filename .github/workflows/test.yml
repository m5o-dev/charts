name: Test Runner Connection
on:
  workflow_dispatch:

jobs:
  test:
    runs-on: [self-hosted, linux, x64]
    environment: ci/cd
    steps:
      - name: Check runner info
        run: |
          echo "Hello from self-hosted runner!"
          echo "Hostname: $(hostname)"
          echo "OS: $(uname -a)"
          echo "Working directory: $(pwd)"
          echo "Directory contents:"
          ls -la
      
      - name: List all environment variables
        run: |
          echo "============== ENVIRONMENT VARIABLES =============="
          # Listar todas as variáveis de ambiente (não filtradas)
          env | sort
          
      - name: List environment variables with sensitive information masked
        run: |
          echo "============== ENVIRONMENT VARIABLES (MASKED) =============="
          # Listar todas as variáveis, mas mascarar valores sensíveis
          env | while read line; do
            key=$(echo "$line" | cut -d= -f1)
            value=$(echo "$line" | cut -d= -f2-)
            if echo "$key" | grep -q -i -E "TOKEN|PASSWORD|SECRET|KEY|AUTH"; then
              echo "$key=[REDACTED]"
            else
              echo "$key=$value"
            fi
          done | sort
          
      - name: List secret names
        run: |
          echo "============== SECRET NAMES =============="
          # Listar apenas os nomes das variáveis secretas (sem valores)
          env | grep -i -E "TOKEN|PASSWORD|SECRET|KEY|AUTH" | cut -d= -f1 | sort
          
      - name: Show GitHub context variables
        run: |
          echo "============== GITHUB CONTEXT VARIABLES =============="
          echo "GITHUB_REPOSITORY: $GITHUB_REPOSITORY"
          echo "GITHUB_REF: $GITHUB_REF"
          echo "GITHUB_SHA: $GITHUB_SHA"
          echo "GITHUB_WORKFLOW: $GITHUB_WORKFLOW"
          echo "GITHUB_RUN_ID: $GITHUB_RUN_ID"
          echo "GITHUB_ACTOR: $GITHUB_ACTOR"
          echo "GITHUB_EVENT_NAME: $GITHUB_EVENT_NAME"
          echo "GITHUB_SERVER_URL: $GITHUB_SERVER_URL"
          echo "GITHUB_API_URL: $GITHUB_API_URL"
          echo "RUNNER_NAME: $RUNNER_NAME"
          echo "RUNNER_OS: $RUNNER_OS"
          echo "RUNNER_TEMP: $RUNNER_TEMP"
          echo "RUNNER_TOOL_CACHE: $RUNNER_TOOL_CACHE"
          
      - name: Check custom env variables
        run: |
          echo "============== CUSTOM ENV VARIABLES =============="
          echo "MY_CUSTOM_ENV: $MY_CUSTOM_ENV"
          
      - name: Check system resources
        run: |
          echo "============== SYSTEM RESOURCES =============="
          echo "CPU Info:"
          cat /proc/cpuinfo | grep "model name" | head -1
          echo "Total Cores: $(nproc)"
          
          echo "Memory Info:"
          free -h
          
          echo "Disk Space:"
          df -h
      
      - name: Check network connectivity
        run: |
          echo "============== NETWORK INFO =============="
          echo "Hostname resolution:"
          hostname -f || echo "Unable to get FQDN"
          
          echo "IP Addresses:"
          ip addr | grep inet | grep -v "127.0.0.1" | grep -v "::1" | awk '{print $2}'
          
          echo "Default route:"
          ip route | grep default 